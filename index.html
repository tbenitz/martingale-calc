<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Martingale Calculator</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 2em auto; padding: 0 1em; }
    h1, h2 { text-align: center; }
    label { display: block; margin: 0.75em 0 0.25em; }
    input[type="number"], button { width: 100%; padding: 0.5em; font-size: 1em; }
    button { margin-top: 1em; cursor: pointer; }
    .result { margin: 0.5em 0; }
    .inline { display: inline-block; margin-right: 1em; }
  </style>
</head>
<body>
  <h1>Martingale Calculator</h1>

  <!-- Inputs -->
  <label>Base Bet ($):
    <input type="number" id="baseBet" value="1.00" step="0.01" min="0">
  </label>

  <label>Bet Increase After Loss (%):
    <input type="number" id="betIncreasePercent" value="100" step="0.01" min="0">
  </label>

  <label>Stop Loss Limit ($):
    <input type="number" id="stopLossLimit" value="500" step="0.01" min="0">
  </label>

  <label>Target Earnings in 1 Hour ($):
    <input type="number" id="targetEarnings" value="100" step="0.01">
  </label>

  <label>Bets per Minute:
    <input type="number" id="betsPerMinute" value="90" step="1" min="1">
  </label>

  <label>Observed Wins Count:
    <input type="number" id="observedWins" value="3182" step="1" min="0">
  </label>

  <label>Observed Losses Count:
    <input type="number" id="observedLosses" value="789" step="1" min="0">
  </label>

  <!-- New field -->
  <label>Spins per Minute:
    <input type="number" id="spinsPerMinute" value="90" step="1" min="1">
  </label>

  <button id="calculateBtn">Calculate</button>

  <!-- Results -->
  <h2>Results</h2>
  <div class="result">
    <span class="inline"><strong>Expected Hourly Profit:</strong> $<span id="expectedProfit">–</span></span>
  </div>
  <div class="result">
    <span class="inline"><strong>Chance of Hitting Stop-Loss in 1 hr:</strong> <span id="stopLossChance">–</span></span>
    (<em>1 in <span id="stopLossOneInX">–</span></em>)
  </div>
  <div class="result">
    <span class="inline"><strong>Chance of Earning ≥ $<span id="targetEarningsDisplay">–</span> in 1 hr:</strong> <span id="chanceEarnings">–</span></span>
  </div>
  <div class="result">
    <span class="inline"><strong>Median Time to Stop-Loss:</strong> <span id="stopLossMedianTime">–</span> minutes</span>
  </div>

  <script>
    // 1) Win probability from observed counts
    function calculateWinProb() {
      const wins = +document.getElementById('observedWins').value || 0;
      const losses = +document.getElementById('observedLosses').value || 0;
      const total = wins + losses;
      return total > 0 ? wins / total : 0;
    }

    // 2) How many consecutive losses until cumulative bets exceed stop-loss
    function calculateStopLossSteps(baseBet, increasePct, stopLimit) {
      let step = 0, cum = 0, bet = baseBet;
      const factor = 1 + increasePct / 100;
      while (cum + bet <= stopLimit) {
        cum += bet;
        bet *= factor;
        step++;
        if (step > 10000) break;  // safety
      }
      return step;
    }

    // 3) Probability of a pure-loss sequence of length N
    function lossSeqProb(winProb, steps) {
      return Math.pow(1 - winProb, steps);
    }

    // 4) Probability to hit that sequence at least once in one hour
    function probHitStopLoss(winProb, steps, betsPerMin) {
      const pSeq = lossSeqProb(winProb, steps);
      const betsPerHour = betsPerMin * 60;
      return 1 - Math.pow(1 - pSeq, betsPerHour);
    }

    // 5) Expected hourly profit (approximate via profit-per-win × wins-per-hour)
    function expectedProfitHourly(winProb, baseBet, increasePct, betsPerMin) {
      const factor = 1 + increasePct / 100;       // e.g. 100% → 2× payout
      const profitPerWin = baseBet * (factor - 1);
      const betsPerHour = betsPerMin * 60;
      return profitPerWin * betsPerHour * winProb;
    }

    // 6) Chance to earn target = at least one win in hour (or 100% if target ≤ 0)
    function probEarnTarget(winProb, betsPerMin, target) {
      if (target <= 0) return 1;
      const betsPerHour = betsPerMin * 60;
      return 1 - Math.pow(1 - winProb, betsPerHour);
    }

    // 7) Median number of rounds before hitting stop-loss sequence
    function medianRoundsBeforeStopLoss(winProb, steps) {
      const pSeq = lossSeqProb(winProb, steps);
      return Math.log(0.5) / Math.log(1 - pSeq);
    }

    document.getElementById('calculateBtn').addEventListener('click', () => {
      // Gather inputs
      const baseBet       = +document.getElementById('baseBet').value;
      const increasePct   = +document.getElementById('betIncreasePercent').value;
      const stopLimit     = +document.getElementById('stopLossLimit').value;
      const targetEarnings= +document.getElementById('targetEarnings').value;
      const betsPerMin    = +document.getElementById('betsPerMinute').value;
      const spinsPerMin   = +document.getElementById('spinsPerMinute').value;
      const winProb       = calculateWinProb();

      // Steps to stop-loss
      const steps = calculateStopLossSteps(baseBet, increasePct, stopLimit);

      // 1. Expected Profit
      const expProfit = expectedProfitHourly(winProb, baseBet, increasePct, betsPerMin);
      document.getElementById('expectedProfit').textContent = expProfit.toFixed(2);

      // 2. Stop-Loss Chance
      const pHit = probHitStopLoss(winProb, steps, betsPerMin);
      document.getElementById('stopLossChance').textContent = (pHit * 100).toFixed(2) + '%';
      document.getElementById('stopLossOneInX').textContent = pHit > 0 ? (1 / pHit).toFixed(0) : '∞';

      // 3. Chance to hit target
      document.getElementById('targetEarningsDisplay').textContent = targetEarnings.toFixed(2);
      const pEarn = probEarnTarget(winProb, betsPerMin, targetEarnings);
      document.getElementById('chanceEarnings').textContent = (pEarn * 100).toFixed(2) + '%';

      // 4. Median time to stop-loss
      const roundsMed = medianRoundsBeforeStopLoss(winProb, steps);
      const minutesMed = spinsPerMin > 0 ? (roundsMed / spinsPerMin) : 0;
      document.getElementById('stopLossMedianTime').textContent = minutesMed.toFixed(2);
    });
  </script>
</body>
</html>
